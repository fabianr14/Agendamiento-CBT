{% extends 'base.html' %}
{% load static %}
{% block title %}Guía de Requisitos - CBT{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Botones -->
    <div class="flex justify-between items-center mb-6 d-print-none">
        <a href="{% url 'home_ciudadano' %}" class="text-sm font-bold text-slate-500 hover:text-slate-800 flex items-center gap-2"><i class="bi bi-arrow-left"></i> Volver</a>
        <button onclick="window.print()" class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-bold hover:bg-slate-700"><i class="bi bi-printer mr-2"></i> Imprimir</button>
    </div>

    <!-- HOJA A4 -->
    <div class="bg-white shadow-2xl p-12 min-h-[29.7cm] relative overflow-hidden border border-slate-200/50 print-sheet">
        <!-- Marca Agua -->
        <img src="{% static 'img/logo_cbt.png' %}" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 opacity-[0.03] pointer-events-none grayscale">

        <!-- Encabezado -->
        <div class="flex items-center justify-between border-b-2 border-slate-900 pb-6 mb-8 relative z-10">
            <div class="flex items-center gap-4">
                <img src="{% static 'img/logo_cbt.png' %}" class="w-16 h-auto">
                <div>
                    <h2 class="text-xl font-black uppercase tracking-tight text-slate-900">Cuerpo de Bomberos</h2>
                    <p class="text-xs font-bold uppercase tracking-widest text-slate-500">Tulcán - Carchi</p>
                </div>
            </div>
            <div class="text-right">
                <h2 class="text-lg font-bold text-slate-800 uppercase">Guía de Requisitos</h2>
                <p class="text-sm font-medium text-slate-600">Normativa Técnica {{ anio_fiscal }}</p>
            </div>
        </div>

        <!-- CONTENIDO AGRUPADO -->
        <div class="relative z-10">
            
            {% regroup requisitos by get_seccion_display as secciones_list %}

            {% for seccion in secciones_list %}
            <div class="mb-8 break-inside-avoid">
                <!-- Título de Categoría -->
                <h3 class="text-base font-black text-white bg-slate-800 px-3 py-1.5 rounded uppercase tracking-wide mb-4 inline-block">
                    {{ seccion.grouper }}
                </h3>
                
                <!-- Lista de Ítems -->
                <div class="space-y-4 pl-2">
                    {% for req in seccion.list %}
                    <div class="flex gap-4">
                        <div class="font-bold text-slate-400 text-sm pt-0.5">{{ req.orden }}.</div>
                        <div class="flex-grow border-b border-slate-100 pb-4">
                            <h4 class="font-bold text-slate-900 text-sm mb-1">{{ req.titulo }}</h4>
                            <p class="text-sm text-slate-600 leading-relaxed text-justify">{{ req.contenido }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% empty %}
            <div class="text-center py-12 border-2 border-dashed border-slate-200 rounded-xl">
                <p class="text-slate-400 italic">No hay requisitos registrados en el sistema actualmente.</p>
            </div>
            {% endfor %}

            <!-- Nota Final -->
            <div class="bg-red-50 border-l-4 border-red-600 p-4 mt-8 rounded-r-lg break-inside-avoid">
                <p class="font-bold text-red-800 mb-1 text-xs uppercase">Nota Importante:</p>
                <p class="text-red-700 text-xs leading-relaxed">
                    El cumplimiento de estos requisitos es indispensable. El Inspector verificará cada punto durante la visita. 
                    El incumplimiento impedirá la emisión del permiso.
                </p>
            </div>
        </div>

        <!-- Pie -->
        <div class="mt-12 border-t border-slate-200 pt-4 text-center text-[10px] text-slate-400 absolute bottom-12 left-0 right-0 w-full px-12">
            Documento generado por CBT Digital • Válido para el año {{ anio_fiscal }}
        </div>
    </div>
    <div class="h-12"></div>
</div>

<style>
@media print {
    body { background: white; }
    nav, .d-print-none { display: none !important; }
    .print-sheet { box-shadow: none !important; margin: 0 !important; width: 100% !important; max-width: 100% !important; padding: 1.5cm !important; border: none !important; }
    .bg-slate-800 { background-color: #000 !important; color: #fff !important; }
    .text-slate-900 { color: #000 !important; }
    .break-inside-avoid { page-break-inside: avoid; }
}
</style>
{% endblock %}